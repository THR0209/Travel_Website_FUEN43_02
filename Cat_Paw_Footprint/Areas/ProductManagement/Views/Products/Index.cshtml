@model IEnumerable<Cat_Paw_Footprint.Models.Products>

@{
    ViewData["Title"] = "Index";
}

@section Styles {
    <link href="~/lib/datatables/css/jquery.datatables.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/2.3.1/css/dataTables.dataTables.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/fixedheader/4.0.2/css/fixedHeader.bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/2.3.3/css/dataTables.dataTables.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/buttons/3.2.4/css/buttons.dataTables.css" rel="stylesheet" />
    <link href="~/lib/datatables/css/mydatatables.css" rel="stylesheet" />
    <style>
        .my-copy {
            background-color: #6c757d !important; /* 灰色 */
            border-color: #6c757d !important;
            color: white !important;
        }

        .my-excel {
            background-color: #198754 !important; /* 綠色 */
            border-color: #198754 !important;
            color: white !important;
        }

        .my-pdf {
            background-color: #dc3545 !important; /* 紅色 */
            border-color: #dc3545 !important;
            color: white !important;
        }

        #test thead th {
            background-color: #22B3C1;
            color: white;
            font-family: "Chiron GoRound TC", sans-serif;
            font-size: 15px;
        }

        .btn-size {
            width: 80%;
            text-align: center;
        }
    </style>
}

<h1>產品管理</h1>

<p>
    <a asp-action="Create" class="btn btn-primary"><i class="fa-solid fa-square-plus"></i> 新增產品</a>
</p>
<table id="test" class="table table-striped table-hover table-bordered">
    <thead class="table-primary">
        <tr class="text-center">
            <th>ID</th>
            <th>流水號</th>
            <th>產品名稱</th>
            <th>產品圖片</th>
            <th>價格</th>
            <th>出團時間</th>
            <th>上架時間</th>
            <th>狀態</th>
            <th>人數上限</th>
        </tr>    
    </thead>
</table>

@section Scripts {
    <script src="~/lib/datatables/js/jquery.datatables.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.datatables.net/2.3.1/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/fixedheader/4.0.2/js/dataTables.fixedHeader.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.2.4/js/dataTables.buttons.js"></script>
    @* <script src="https://cdn.datatables.net/buttons/3.2.4/js/buttons.dataTables.js"></script> *@
    <link href="~/lib/datatables/css/buttons.datatables.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.2.4/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.2.4/js/buttons.print.min.js"></script>

    

    <script>
        DataTable.type('num', 'className', 'dt-body-right');
        DataTable.type('num-fmt', 'className', 'dt-body-right');
        DataTable.type('date', 'className', 'dt-body-right');


         $(document).ready(function () {
            $('#test').dataTable({
                ajax: {
                    type: 'POST',
                    url: '@Url.Action("IndexJson", "Products", new { area = "ProductManagement" })',
                    dataSrc: ''
                },
                columns: [
                    { data: "productID", visible: false },
                    { data: "productCode", title: "產品編號", "width": "5%" },
                    { data: "productImage", title: "產品封面照", "width": "10%", className: 'text-center align-middle', render: imgRender, defaultContent: ''},
                    { data: "productName", title: "產品名稱", "width": "10%" },
                    { data: "isActive", title: "狀態", width: "6%", render: statusRender, className:"dt-center" },
                    { data: "productPrice", title: "價格", "width": "10%" },
                    { data: "startDate", title: "出團時間", "width": "10%" },
                    { data: "analyses[0].releaseDate", title: "上架時間", "width": "10%", defaultContent: '' },
                    // { data: "endDate", title: "下架時間", "width": "10%" },
                    { data: "maxPeople", title: "人數上限", "width": "10%" },
                    // { data: "regionName", title: "出團區域", "width": "10%" },
                    {
                        data: null,
                        title: "操作",
                        orderable: false,
                        searchable: false,
                        width: "9%",
                        render: function (data, type, row) {
                            return `
                               <a href="/ProductManagement/Products/Edit/${row.productID}" class="btn btn-sm btn-primary ms-2 mb-2 btn-size">編輯</a>
                               <a href="/ProductManagement/Products/Details/${row.productID}" class="btn btn-sm btn-secondary ms-2 mb-2 btn-size">詳細內容</a>
                               <a href="/ProductManagement/Products/Delete/${row.productID}" class="btn btn-sm btn-danger ms-2 mb-2 btn-size">刪除</a>
                            `;
                        }
                    }
                ],
                order: [[0, 'desc']],
                fixedHeader: { header: true },
                language: {
                    url:'https://cdn.datatables.net/plug-ins/1.13.1/i18n/zh-HANT.json'
                },
                // dom: 'Bftip',
                // buttons: [
                //     {
                //         extend: 'copy',
                //         text: '📋 複製',
                //         className: 'btn btn-secondary my-copy'
                //     },
                //     {
                //         extend: 'csv',
                //         text: '📊 匯出 Excel',
                //         className: 'btn btn-success my-excel',
                //         filename: '產品清單',
                //         title: '我的產品資料'
                //     },
                //     {
                //         extend: 'pdf',
                //         text: '📄 下載 PDF',
                //         className: 'btn btn-danger my-pdf',
                //         filename: '產品清單',
                //         title: '我的產品資料'
                //     }
                // ]
            });
         });

        function imgRender(b64) {  // 二進位轉回圖片
            if (!b64) return '';
            // byte[] 會被序列化成 base64 字串
            return `<img class="d-block mx-auto rounded-2" src="data:image/*;base64,${b64}" style="width:64px;height:48px;object-fit:cover;border-radius:6px;">`;
        };

        function statusRender(status) {
            if (status) {
                return `<span class="badge bg-success text-center">上架中</span>`;
            }
            else {
                return  `<span class="badge bg-danger text-center">下架</span>`;
            }
        }
    </script>
}
