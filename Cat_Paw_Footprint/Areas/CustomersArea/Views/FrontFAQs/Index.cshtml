@{
    ViewData["Title"] = "Â∏∏Ë¶ãÂïèÈ°å";
}

@section Styles {
    <style>
        body {
            background: #f4f8fb;
        }

        /* Áµ±‰∏ÄÂØ¨Â∫¶Ê®£Âºè */
        .faq-section {
            max-width: 1100px;
            margin: 0 auto;
        }

        /* Ê®ôÈ°åÂçÄ */
        .faq-header {
            background: linear-gradient(135deg, #eaf6ff, #f9f9fd);
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 2.5rem 2rem 1.5rem;
            margin-bottom: 2.5rem;
        }

            .faq-header h2 {
                letter-spacing: 2px;
                color: #7ec8e3;
            }

        .faq-search-box {
            border-radius: 40px;
            border: 1px solid #d5e5f7;
            font-size: 1.25rem;
            padding: 1rem 2.5rem;
            background: #fff;
            margin-top: 1.2rem;
            transition: all .2s;
        }

            .faq-search-box:focus {
                border-color: #226dd3;
                box-shadow: 0 0 0 3px rgba(34, 109, 211, 0.1);
            }

        .faq-search-wrapper {
            position: relative;
            width: 100%;
        }

        .faq-search-result-box {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: calc(100% + 10px);
            background: #fff;
            width: 90%;
            max-height: 300px;
            overflow-y: auto;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            display: none;
            z-index: 999;
            text-align: left;
        }

        .faq-search-result-item {
            padding: 0.8rem 1.2rem;
            border-bottom: 1px solid #f0f4fa;
            cursor: pointer;
            transition: background .2s;
        }

            .faq-search-result-item:hover {
                background: #f3f9ff;
            }

            .faq-search-result-item:last-child {
                border-bottom: none;
            }

        /* ÁÜ±ÈñÄÂïèÈ°å */
        .faq-popular-carousel {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            padding-bottom: 1rem;
        }

        .faq-popular-item {
            flex: 0 0 320px;
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            margin-right: .5rem;
            cursor: pointer;
            transition: all .2s;
        }

            .faq-popular-item:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 18px rgba(34, 109, 211, 0.12);
            }

        .faq-answer-preview {
            color: #666;
            font-size: 0.95rem;
            margin-top: .5rem;
            max-height: 3.6rem;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ÂàÜÈ°ûÂç°Áâá */
        .faq-category-card {
            background: #ffffff;
            border-radius: 18px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            text-align: center;
            padding: 1rem;
            cursor: pointer;
            transition: all .25s;
            border: 1px solid #eaf2ff;
        }

            .faq-category-card:hover {
                background: linear-gradient(135deg, #dceeff, #f6faff);
                transform: translateY(-3px);
                box-shadow: 0 6px 16px rgba(34, 109, 211, 0.12);
            }

        .faq-category-icon {
            font-size: 1.9rem;
            color: #7ec8e3;
            margin-bottom: .3rem;
        }

        /* ÂïèÈ°åÂç°Áâá */
        .faq-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 1.5rem 1.5rem;
            margin-bottom: 1.25rem;
            transition: box-shadow .2s, transform .2s;
        }

            .faq-card:hover {
                box-shadow: 0 6px 18px rgba(34, 109, 211, 0.10);
                transform: translateY(-2px);
            }

        .faq-card-question {
            font-weight: 600;
            color: #2255aa;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 1.1rem;
        }

        .faq-card-answer {
            display: none;
            margin-top: 1rem;
            color: #444;
            line-height: 1.6;
        }

        .faq-card.open .faq-card-answer {
            display: block;
        }

        .faq-card.open .faq-icon i {
            transform: rotate(180deg);
        }

        .faq-icon i {
            transition: transform .3s;
            color: #2255aa;
        }

        .faq-section h4 {
            margin-bottom: 1.5rem;
        }
    </style>
}

<div class="container py-5">
    <!-- Â∏∏Ë¶ãÂïèÈ°åÊ®ôÈ°åÂçÄ -->
    <div class="faq-section faq-header text-center">
        <h2 class="fw-bold mb-3">Â∏∏Ë¶ãÂïèÈ°å</h2>

        <div class="faq-search-wrapper position-relative d-inline-block w-100">
            <input type="text" id="faqSearch" class="faq-search-box form-control" placeholder="üîç ÊêúÂ∞ãÂ∏∏Ë¶ãÂïèÈ°å...">
            <div id="faqSearchResults" class="faq-search-result-box"></div>
        </div>
    </div>

    <!-- ÁÜ±ÈñÄÂ∏∏Ë¶ãÂïèÈ°å -->
    <div class="faq-section mb-5">
        <h4 class="fw-bold mb-3"><i class="fas fa-fire text-danger"></i> ÁÜ±ÈñÄÂ∏∏Ë¶ãÂïèÈ°å</h4>
        <div class="faq-popular-carousel" id="hotFaqCarousel"></div>
    </div>

    <!-- ÂïèÈ°åÂàÜÈ°û -->
    <div class="faq-section mb-5">
        <h4 class="fw-bold mb-3"><i class="fas fa-list text-primary"></i> ÂïèÈ°åÂàÜÈ°û</h4>
        <div class="row g-3" id="faqCategories"></div>
    </div>

    <!-- FAQ Ë©≥Á¥∞ÂàóË°® -->
    <div class="faq-section">
        <div id="faqDetailList"></div>
    </div>
</div>

@section Scripts {
    <script>
        let allFaqs = [];
        let categories = [];

        $(function () {
            // ÁÜ±ÈñÄFAQ
            $.getJSON('/CustomersArea/FrontFAQs/api/hot', function (faqs) {
                let html = "";
                faqs.forEach((faq, idx) => {
                    html += `
                        <div class="faq-popular-item" tabindex="0" role="button" data-idx="${idx}">
                            <div class="fw-bold mb-2"><i class="fas fa-question-circle text-primary me-2"></i>${faq.question}</div>
                            <div class="faq-answer-preview">${faq.answer}</div>
                        </div>
                    `;
                });
                $('#hotFaqCarousel').html(html);

                $('#hotFaqCarousel .faq-popular-item').on('click', function () {
                    const idx = $(this).data('idx');
                    showFaqDetail([faqs[idx]], "ÁÜ±ÈñÄÂ∏∏Ë¶ãÂïèÈ°å");
                });
            });

            // ÂÖ®ÈÉ®FAQ
            $.getJSON('/CustomersArea/FrontFAQs/api/all', function (faqs) {
                allFaqs = faqs;
            });

            // FAQÂàÜÈ°û
            $.getJSON('/CustomersArea/FrontFAQs/api/categories', function (cats) {
                categories = cats;
                renderCategories();
            });

            // ÊêúÂ∞ãÂäüËÉΩ
            $('#faqSearch').on('input', function () {
                const kw = $(this).val().toLowerCase().trim();
                const $box = $('#faqSearchResults');

                if (!kw) {
                    $box.hide().empty();
                    return;
                }

                const result = allFaqs.filter(f =>
                    (f.question && f.question.toLowerCase().includes(kw)) ||
                    (f.answer && f.answer.toLowerCase().includes(kw))
                );

                if (result.length === 0) {
                    $box.html('<div class="p-3 text-muted">Êü•ÁÑ°Áõ∏ÈóúÂïèÈ°å</div>').show();
                    return;
                }

                let html = result.slice(0, 6).map((f, idx) => `
                    <div class="faq-search-result-item" data-id="${idx}">
                        <i class="fas fa-question-circle text-primary me-2"></i>${f.question}
                    </div>
                `).join('');

                $box.html(html).show();

                // ÈªûÊìäÊüêÂÄãÈ†ÖÁõÆÈ°ØÁ§∫ÂÆåÊï¥ÂÖßÂÆπ
                $('.faq-search-result-item').on('click', function () {
                    const id = $(this).data('id');
                    $box.hide();
                    showFaqDetail([result[id]], "ÊêúÂ∞ãÁµêÊûú");
                    $('html, body').animate({
                        scrollTop: $('#faqDetailList').offset().top - 100
                    }, 500);
                });
            });

            // ÈªûÊìäÂÖ∂‰ªñÂú∞ÊñπÈóúÈñâÊêúÂ∞ãÊ°ÜÁµêÊûú
            $(document).on('click', function (e) {
                if (!$(e.target).closest('#faqSearch, #faqSearchResults').length) {
                    $('#faqSearchResults').hide();
                }
            });
        });

        // FAQÂàÜÈ°ûÊ∏≤Êüì
        function renderCategories() {
            let icons = ['fa-folder', 'fa-tags', 'fa-life-ring', 'fa-user-circle', 'fa-cube', 'fa-credit-card', 'fa-truck', 'fa-envelope'];
            let html = '';
            categories.forEach((cat, i) => {
                html += `
                    <div class="col-6 col-md-4 col-lg-3">
                        <div class="faq-category-card" data-id="${cat.id}">
                            <div class="faq-category-icon fa ${icons[i % icons.length]}"></div>
                            <div class="fw-bold">${cat.name}</div>
                        </div>
                    </div>`;
            });
            $('#faqCategories').html(html);

            $('.faq-category-card').on('click', function () {
                const catid = $(this).data('id');
                const result = allFaqs.filter(f => f.categoryID == catid);
                const catName = categories.find(c => c.id == catid).name;
                showFaqDetail(result, catName);
            });
        }

        // FAQË©≥Á¥∞Ê∏≤ÊüìÔºàÂç°ÁâáÂºèÔºâ
        function showFaqDetail(faqs, title) {
            let html = `<h4 class="fw-bold mb-4"><i class="fas fa-question text-primary"></i> ${title}</h4>`;
            if (faqs.length === 0) {
                html += '<div class="alert alert-warning">Êü•ÁÑ°Áõ∏ÈóúÂïèÈ°å</div>';
            } else {
                faqs.forEach((faq, idx) => {
                    html += `
                        <div class="faq-card" data-id="${idx}">
                            <div class="faq-card-question">
                                <span><i class="fas fa-question-circle me-2 text-primary"></i>${faq.question}</span>
                                <span class="faq-icon"><i class="fas fa-chevron-down"></i></span>
                            </div>
                            <div class="faq-card-answer">${faq.answer}</div>
                        </div>`;
                });
            }
            $('#faqDetailList').html(html);

            // Âç°ÁâáÂ±ïÈñã/Êî∂Âêà
            $('.faq-card').on('click', function () {
                $(this).toggleClass('open');
            });
        }
    </script>
}
