@{
    ViewData["Title"] = "常見問題";
}


@section Styles {
    <style>
        body {
            background: #f8fafd;
        }

        .faq-header {
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-radius: 20px;
            padding: 2.5rem 2rem 1.5rem;
            margin-bottom: 2rem;
        }

        .faq-search-box {
            border-radius: 40px;
            border: 1px solid #d5e5f7;
            font-size: 1.25rem;
            padding: 1rem 2.5rem;
            background: #f7faff;
            margin-bottom: 2rem;
        }

        .faq-popular-carousel {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            padding-bottom: 1rem;
        }

        .faq-popular-item {
            flex: 0 0 320px;
            background: #ffffff;
            border-radius: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            padding: 1.5rem;
            margin-right: .5rem;
            transition: box-shadow .2s;
        }

        .faq-popular-item:hover {
            box-shadow: 0 6px 16px rgba(34,109,211,0.12);
        }

        .faq-category-card {
            background: linear-gradient(90deg, #eaf6ff 0%, #f9f9fd 70%);
            border-radius: 16px;
            padding: 1.2rem .5rem;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
            text-align: center;
            cursor: pointer;
            transition: background .2s, box-shadow .2s;
            border: none;
            margin-bottom: 1rem;
        }

        .faq-category-card:hover {
            background: linear-gradient(90deg, #d5e5f7 0%, #f7faff 100%);
            box-shadow: 0 2px 8px rgba(34,109,211,0.10);
        }

        .faq-category-icon {
            font-size: 2rem;
            color: #226dd3;
            margin-bottom: .5rem;
        }

        .faq-detail-accordion .accordion-item {
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 1px 8px rgba(34,109,211,0.08);
            border: none;
            overflow: hidden;
        }

        .faq-detail-accordion .accordion-button {
            background: #f7faff;
            font-weight: 500;
            font-size: 1.1rem;
            border-radius: 0;
            padding: 1rem 1.5rem;
        }

        .faq-detail-accordion .accordion-body {
            background: #fff;
            padding: 1.2rem 1.5rem;
            font-size: 1.05rem;
            color: #444;
        }

    </style>

}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 faq-header mx-auto">
            <h2 class="fw-bold text-center mb-3" style="letter-spacing:2px;">常見問題</h2>
            <input type="text" id="faqSearch" class="faq-search-box form-control" placeholder="🔍 搜尋常見問題...">
        </div>
    </div>
    <!-- 熱門常見問題 (Carousel) -->
    <div class="row justify-content-center mb-4">
        <div class="col-lg-10">
            <h4 class="fw-bold mb-3"><i class="fas fa-fire text-danger"></i> 熱門常見問題</h4>
            <div class="faq-popular-carousel" id="hotFaqCarousel"></div>
        </div>
    </div>
    <!-- 問題分類 -->
    <div class="row justify-content-center mb-4">
        <div class="col-lg-11">
            <h4 class="fw-bold mb-3">問題分類</h4>
            <div class="row g-2" id="faqCategories"></div>
        </div>
    </div>
    <!-- FAQ 詳細列表（分類或搜尋結果顯示） -->
    <div class="row justify-content-center">
        <div class="col-lg-11">
            <div id="faqDetailList"></div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let allFaqs = [];
        let categories = [];
        $(function () {
            // 熱門FAQ (Carousel)
            $.getJSON('/CustomersArea/FrontFAQs/api/hot', function (faqs) {
                let html = "";
                faqs.forEach((faq, idx) => {
                    html += `
                        <div class="faq-popular-item" tabindex="0" role="button" data-idx="${idx}">
                            <div class="fw-bold mb-2"><i class="fas fa-question-circle text-primary me-2"></i>${faq.question}</div>
                            <div class="faq-answer-preview">${faq.answer}</div>
                        </div>
                    `;
                });
                $('#hotFaqCarousel').html(html);

                // 點擊事件統一監聽
                $('#hotFaqCarousel .faq-popular-item').on('click', function () {
                    const idx = $(this).data('idx');
                    showFaqDetail([faqs[idx]], "熱門常見問題");
                });
            });

            // 全部FAQ
            $.getJSON('/CustomersArea/FrontFAQs/api/all', function (faqs) {
                allFaqs = faqs;
            });

            // FAQ分類
            $.getJSON('/CustomersArea/FrontFAQs/api/categories', function (cats) {
                categories = cats;
                renderCategories();
            });

            // 搜尋功能
            $('#faqSearch').on('input', function () {
                const kw = $(this).val().toLowerCase();
                const result = allFaqs.filter(f =>
                    (f.question && f.question.toLowerCase().includes(kw)) ||
                    (f.answer && f.answer.toLowerCase().includes(kw))
                );
                showFaqDetail(result, "搜尋結果");
            });
        });

        // FAQ分類渲染
        function renderCategories() {
            let icons = ['fa-folder', 'fa-tags', 'fa-life-ring', 'fa-user-circle', 'fa-cube', 'fa-credit-card', 'fa-truck', 'fa-envelope']; // 可自行分配
            let html = '';
            categories.forEach((cat, i) => {
                html += `<div class="col-6 col-md-4 col-lg-3">
                    <div class="faq-category-card shadow-sm" data-id="${cat.id}">
                        <span class="faq-category-icon fa ${icons[i%icons.length]}"></span>
                        <div class="fw-bold">${cat.name}</div>
                    </div>
                </div>`;
            });
            $('#faqCategories').html(html);
            $('.faq-category-card').on('click', function () {
                const catid = $(this).data('id');
                const result = allFaqs.filter(f => f.categoryID == catid);
                showFaqDetail(result, categories.find(c => c.id == catid).name);
            });
        }

        // FAQ詳細渲染（分類/搜尋）
        function showFaqDetail(faqs, title) {
            let html = `<h4 class="fw-bold mb-3">${title}</h4>`;
            if (faqs.length === 0) {
                html += '<div class="alert alert-warning">查無相關問題</div>';
            } else {
                html += `<div class="accordion faq-detail-accordion" id="faqDetailAccordion">`;
                faqs.forEach((faq, idx) => {
                    html += `
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="heading${idx}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapse${idx}" aria-expanded="false" aria-controls="collapse${idx}">
                                    <span class="text-primary fw-bold"><i class="fas fa-question-circle me-2"></i>${faq.question}</span>
                                </button>
                            </h2>
                            <div id="collapse${idx}" class="accordion-collapse collapse"
                                aria-labelledby="heading${idx}" data-bs-parent="#faqDetailAccordion">
                                <div class="accordion-body">${faq.answer}</div>
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            $('#faqDetailList').html(html);
        }
    </script>
}