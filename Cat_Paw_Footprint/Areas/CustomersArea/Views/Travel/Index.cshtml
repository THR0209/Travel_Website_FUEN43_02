@section Styles {
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" >
    <link href="~/css/travel.css" rel="stylesheet" />
    <style ></style>
}

@{
    ViewData["Title"] = "自由行專區";
}

<div id="app">
    <div class="row">
        <!-- 上方按鈕 -->
        <div class="top-buttons sticky-top bg-white shadow-sm py-3 z-3">
            <div class="d-flex justify-content-center gap-3">
                <button v-for="btn in buttons" :key="btn.type"
                        class="btn rounded-pill"
                        :class="{'btn-warning': currentType===btn.type, 'btn-outline-secondary': currentType!==btn.type}"
                        @@click="changeType(btn.type)">
                    {{ btn.label }}
                </button>
            </div>
        </div>

        <!-- 左側顯示卡片 (動態載入區) -->
        <div class="col-md-8">
            <div class="row">
                <div v-for="(item, index) in items" :key="index" class="col-md-4 mb-4">
                    <div class="card">

                        <!-- Bootstrap 輪播 -->
                        <div :id="'carousel-'+item.id" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                <div v-if="!item.pictureUrl || item.pictureUrl.length===0">
                                    <img src="https://via.placeholder.com/300x180?text=No+Image" class="d-block w-100" />
                                </div>
                                <div v-else v-for="(pic, i) in item.pictureUrl" :key="i"
                                     class="carousel-item" :class="{'active': i===0}">
                                    <img :src="pic || 'https://via.placeholder.com/300x180?text=No+Image'" alt="圖片">
                                </div>
                            </div>
                        </div>
                        <div class="card-body text-center">
                            <h5 class="card-title">{{ item.name }}</h5>
                            <p class="text-muted">{{ item.regionName }} - {{ item.districtName }}</p>
                            <p>⭐ {{ item.rating }}　👁️ {{ item.views }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 右側排行程與地圖 -->
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header bg-primary text-white">排行程</div>
                <div class="card-body">
                    <p>這裡可以顯示使用者的行程計畫。</p>
                </div>
            </div>
            <div class="card">
                <div class="card-header bg-success text-white">行程地圖</div>
                <div class="card-body">
                    <p>這裡未來可以整合 Google Maps。</p>
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts{
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/vue@3.5.22/dist/vue.global.js"></script>

    @* <script>
        var vueApp={
            data(){
                return{ //model
                    message:"Hello Vue!"
                };
            },
            methods:{ //controller

            }
        };
        var app=Vue.createApp(vueApp).mount("#app"); //View
    </script> *@
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    buttons: [
                        { label: "景點", type: "locations" },
                        { label: "美食", type: "restaurants" },
                        { label: "住宿", type: "hotels" }
                    ],
                    currentType: "locations",
                    items: []
                }
            },
            methods: {
                // 改變分類 (景點/美食/住宿)
                async changeType(type) {
                    this.currentType = type;
                    await this.fetchData();
                },
                // 取得資料 (Ajax 呼叫 Controller)
                async fetchData() {
                    const res = await fetch(`/api/${this.currentType}`, {
                        headers: {
                            "X-Requested-With": "XMLHttpRequest" // 識別為 Ajax 呼叫
                        }
                    });
                    const json = await res.json();

                    // 後端 JSON 轉換成前端使用格式
                    this.items = json.map(x => ({
                        id: x.hotelID || x.locationID || x.restaurantID,
                        name: x.hotelName || x.locationName || x.restaurantName,
                        regionName: x.regionName,
                        districtName: x.districtName,
                        rating: x.rating,
                        views: x.views,
                        pictureUrl: x.pictureUrl || []
                    }));
                }
            },
            mounted() {
                // 預設載入景點
                this.fetchData();
            }
        }).mount("#app");
    </script>
}

