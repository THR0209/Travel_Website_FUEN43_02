@using System.Security.Claims
@{
    ViewData["Title"] = "客服工單管理";
    // 取得目前登入者的員工名稱與ID（需登入時正確加入 Claims）
    var empName = User.FindFirst("EmployeeName")?.Value ?? User.Identity.Name ?? "未登入";
    var empID = User.FindFirst("EmployeeID")?.Value ?? "";
}

@section Styles {
    <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" rel="stylesheet" />
    <link href="~/css/tickets.css" rel="stylesheet" />
}
<h1>客服工單維護</h1>
<div class="card">
    <div class="toolbar">
        <button class="btn btn-primary mb-3" id="btnAddTicket">
            <i class="fa-solid fa-square-plus"></i>新增工單
        </button>
    </div>
    <table class="table table-bordered" id="ticketTable">
        <thead>
            <tr>
                <th>工單編號</th>
                <th>客戶</th>
                <th>處理人員</th>
                <th>狀態</th>
                <th>優先度</th>
                <th>主旨</th>
                <th>建立時間</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- 工單 Modal -->
    <div class="modal fade" id="ticketModal" tabindex="-1" aria-labelledby="ticketModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ticketModalLabel">工單資訊</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="ticketForm">
                        <input type="hidden" id="ticketID" />
                        <div class="mb-3">
                            <label for="customerName" class="form-label">客戶</label>
                            <input type="text" id="customerName" class="form-control" placeholder="輸入客戶名稱..." required />
                            <input type="hidden" id="customerID" />
                        </div>
                        <div class="mb-3">
                            <label for="employeeName" class="form-label">處理人員</label>
                            <!-- 顯示目前登入員工名稱，不可編輯 -->
                            <input type="text" id="employeeName" class="form-control" value="@empName" disabled />
                            <input type="hidden" id="employeeID" value="@empID" />
                        </div>
                        <div class="mb-3">
                            <label for="subject" class="form-label">主旨</label>
                            <input type="text" id="subject" class="form-control" required />
                        </div>
                        <div class="mb-3">
                            <label for="description" class="form-label">內容</label>
                            <textarea id="description" class="form-control"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="ticketTypeID" class="form-label">類型</label>
                                <select id="ticketTypeID" class="form-select"></select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="statusID" class="form-label">狀態</label>
                                <select id="statusID" class="form-select"></select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="priorityID" class="form-label">優先級</label>
                                <select id="priorityID" class="form-select"></select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                    <button type="button" class="btn btn-primary" id="saveTicket">保存</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/tickets.js"></script>
}